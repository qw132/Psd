 <script>
  // تحقق من تسجيل الدخول عند تحميل الصفحة
  if (!localStorage.getItem('isLoggedIn')) {
      window.location.href = 'login.html';
      }

      // تحقق دوري من حالة تسجيل الدخول
      setInterval(function() {
          if (!localStorage.getItem('isLoggedIn')) {
                  window.location.href = 'index.html';
                      }
                      }, 1000);
                      </script>
      
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>متابعة الحضور والدفع</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      margin: 0;
      padding: 20px;
      background: #f7f3ef;
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      padding: 20px 0;
      background: #6699cc;
      color: white;
      border-radius: 10px 10px 0 0;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      font-size: 2.2em;
    }
    .header p {
      margin: 5px 0 0 0;
      font-size: 1.1em;
    }
    .teachers-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    .teacher-btn {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      height: 180px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      border: none;
    }
    .teacher-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .teacher-btn h2 {
      margin: 10px 0 5px 0;
      font-size: 1.4em;
      color: #333;
    }
    .teacher-btn p {
      margin: 0;
      color: #666;
      font-size: 1.1em;
    }
    .back-btn {
      display: inline-block;
      background: #6699cc;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      margin-bottom: 20px;
      font-weight: bold;
    }
    .section {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .attendance-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .attendance-table th, .attendance-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }
    .attendance-table th {
      background: #e0d4c7;
      color: #333;
      font-weight: bold;
    }
    .attendance-table tr:nth-child(even) {
      background: #f9f5f0;
    }
    .month-header {
      background: #6699cc !important;
      color: white !important;
      text-align: center !important;
      font-weight: bold !important;
      font-size: 1.2em !important;
    }
    .payment-section {
      margin-top: 30px;
      padding: 15px;
      border: 2px solid #eee;
      border-radius: 8px;
      background: #f9f5f0;
    }
    .payment-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #555;
    }
    input, button, select {
      padding: 10px;
      margin-top: 5px;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }
    button {
      background: #6699cc;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      padding: 12px;
      margin-top: 20px;
      transition: background 0.3s;
    }
    button:hover {
      background: #5a89b9;
    }
    .payment-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-weight: bold;
      font-size: 1.1em;
      margin: 15px 0;
    }
    .paid {
      color: #28a745;
    }
    .not-paid {
      color: #dc3545;
    }
    .add-lesson-btn {
      background: #28a745;
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .add-lesson-btn:hover {
      background: #218838;
    }
    .delete-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 3px 8px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      margin-right: 5px;
    }
    .delete-btn:hover {
      background: #c82333;
    }
    .hidden {
      display: none;
    }
    .success-icon {
      color: #28a745;
      font-size: 1.2em;
      margin-left: 5px;
    }
    .payment-info {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border: 1px solid #ddd;
    }
    .payment-info h4 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .payment-info p {
      margin: 5px 0;
    }
    .payment-info b {
      color: #555;
    }
    .lesson-group {
      margin-bottom: 30px;
      border-bottom: 2px solid #eee;
      padding-bottom: 20px;
    }
    .group-header {
      background: #6699cc;
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: bold;
      font-size: 1.2em;
    }
    .settings-section {
      background: #f9f5f0;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .settings-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .settings-row label {
      flex: 1;
      text-align: right;
    }
    .settings-row input {
      flex: 2;
    }
    .payments-history {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #eee;
    }
    .payments-history h3 {
      margin-bottom: 15px;
      color: #333;
    }
    .lesson-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      max-width: 90%;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .close-modal {
      background: #dc3545;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
    }
    .profile-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .profile-btn {
      background: #6699cc;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      border: none;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }
    .profile-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    /* Payment Modal Styles */
    #paymentModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .image-upload {
      border: 2px dashed #ddd;
      padding: 20px;
      text-align: center;
      margin: 15px 0;
      border-radius: 8px;
      cursor: pointer;
    }
    .image-upload:hover {
      border-color: #6699cc;
    }
    .image-upload p {
      margin: 10px 0;
      color: #666;
    }
    .uploaded-image {
      max-width: 100%;
      max-height: 200px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .receipt-image {
      max-width: 100%;
      max-height: 300px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    @media (max-width: 768px) {
      .teachers-grid {
        grid-template-columns: 1fr;
      }
      .payment-form {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Home Page -->
  <div id="homePage">
    <div class="header">
      <h1>📚 متابعة الحضور والدفع</h1>
      <p>نظام متكامل لمتابعة حضور الدروس والدفعات الشهرية</p>
    </div>
    
    <div id="settingsSection" class="settings-section">
      <h3>⚙️ بيانات الطالب</h3>
      <div class="settings-row">
        <label>اسم الطالب:</label>
        <input type="text" id="studentName" placeholder="أدخل اسمك">
      </div>
      <div class="settings-row">
        <label>الصف الدراسي:</label>
        <input type="text" id="studentGrade" placeholder="أدخل صفّك">
      </div>
      <button onclick="saveStudentSettings()" style="width: 100%;">💾 حفظ البيانات</button>
    </div>
    
    <div class="teachers-grid">
      <button class="teacher-btn" id="teacher-english">
        <h2>أ / عبدالعزيز موافي</h2>
        <p>لغة إنجليزية</p>
      </button>
      <button class="teacher-btn" id="teacher-math">
        <h2>أ / محمد فوزي</h2>
        <p>رياضيات</p>
      </button>
      <button class="teacher-btn" id="teacher-social">
        <h2>أ / ياسر جاد</h2>
        <p>دراسات</p>
      </button>
      <button class="teacher-btn" id="teacher-science">
        <h2>أ / باسم</h2>
        <p>علوم</p>
      </button>
    </div>
    
    <!-- Profile button centered below teacher buttons -->
    <div class="profile-container">
      <button class="profile-btn" id="profileBtn">بياناتي</button>
    </div>
  </div>

  <!-- Teacher Pages -->
  <div id="teacherPage" class="hidden">
    <div class="header">
      <h1 id="teacherTitle">متابعة الحضور والدفع</h1>
      <p id="teacherSubject">المادة</p>
    </div>
    
    <a href="#" class="back-btn" id="backBtn">العودة للرئيسية</a>
    
    <div class="section">
      <h2>📅 جدول الحصص</h2>
      <div id="lessonsContainer">
        <!-- Will be filled by JavaScript -->
      </div>
      
      <button class="add-lesson-btn" id="addLessonBtn">
        ➕ إضافة حصة جديدة
      </button>
    </div>
    
    <!-- Payments History -->
    <div id="paymentsHistory" class="section">
      <h2>📋 سجل المدفوعات</h2>
      <table class="attendance-table" id="paymentsTable">
        <thead>
          <tr>
            <th>الشهر</th>
            <th>المبلغ</th>
            <th>تاريخ الدفع</th>
            <th>رقم الوصل</th>
            <th>عرض</th>
          </tr>
        </thead>
        <tbody id="paymentsBody">
          <!-- Will be filled by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="lesson-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>👤 بيانات الطالب</h3>
        <button class="close-modal" id="closeProfileModal">×</button>
      </div>
      <div class="settings-section">
        <div class="settings-row">
          <label>اسم الطالب:</label>
          <input type="text" id="modalStudentName" placeholder="أدخل اسمك">
        </div>
        <div class="settings-row">
          <label>الصف الدراسي:</label>
          <input type="text" id="modalStudentGrade" placeholder="أدخل صفّك">
        </div>
        <button onclick="saveStudentSettingsFromModal()" style="width: 100%;">💾 حفظ البيانات</button>
      </div>
    </div>
  </div>

  <!-- Lesson Modal -->
  <div id="lessonModal" class="lesson-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>➕ إضافة حصة جديدة</h3>
        <button class="close-modal" id="closeLessonModal">×</button>
      </div>
      <div class="settings-section">
        <div class="settings-row">
          <label>تاريخ الحصة:</label>
          <input type="date" id="lessonDate">
        </div>
        <div class="settings-row">
          <label>يوم الحصة:</label>
          <select id="lessonDay">
            <option value="الأحد">الأحد</option>
            <option value="الإثنين">الإثنين</option>
            <option value="الثلاثاء">الثلاثاء</option>
            <option value="الأربعاء">الأربعاء</option>
            <option value="الخميس">الخميس</option>
            <option value="الجمعة">الجمعة</option>
            <option value="السبت">السبت</option>
          </select>
        </div>
        <button onclick="confirmAddLesson()" style="width: 100%;">✅ تأكيد الإضافة</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="lesson-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>⚠️ تأكيد الحذف</h3>
        <button class="close-modal" id="closeDeleteModal">×</button>
      </div>
      <div style="padding: 15px;">
        <p>هل أنت متأكد من رغبتك في حذف هذه الحصة؟</p>
        <p id="deleteLessonInfo"></p>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button onclick="confirmDeleteLesson()" style="background: #dc3545; flex: 1;">نعم، احذف</button>
          <button onclick="closeDeleteModal()" style="flex: 1;">إلغاء</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div id="paymentModal" class="lesson-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>💰 تسجيل الدفع</h3>
        <button class="close-modal" id="closePaymentModal">×</button>
      </div>
      <div class="settings-section">
        <div class="settings-row">
          <label>الشهر:</label>
          <select id="paymentMonth">
            <option value="0">الشهر 1</option>
            <option value="1">الشهر 2</option>
            <option value="2">الشهر 3</option>
            <option value="3">الشهر 4</option>
            <option value="4">الشهر 5</option>
            <option value="5">الشهر 6</option>
            <option value="6">الشهر 7</option>
            <option value="7">الشهر 8</option>
          </select>
        </div>
        <div class="settings-row">
          <label>المبلغ (جنيه):</label>
          <input type="number" id="paymentAmount" placeholder="أدخل المبلغ">
        </div>
        <div class="settings-row">
          <label>تاريخ الدفع:</label>
          <input type="date" id="paymentDate">
        </div>
        <div class="settings-row">
          <label>رقم الوصل:</label>
          <input type="text" id="receiptNumber" placeholder="أدخل رقم الوصل">
        </div>
        <div class="image-upload" onclick="document.getElementById('imageUpload').click()">
          <p>اضغط لرفع صورة الوصل</p>
          <p>أو اسحب الصورة هنا</p>
          <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="previewImage(event)">
          <img id="preview" class="uploaded-image" style="display: none;">
        </div>
        <button onclick="confirmPayment()" style="width: 100%;">✅ تأكيد الدفع</button>
      </div>
    </div>
  </div>

  <script>
    // Current page state
    let currentPage = 'home';
    let currentTeacher = null;
    let lessonToDelete = null;
    
    // Teacher data
    const teachers = {
      'english': { name: 'أ / عبدالعزيز موافي', subject: 'لغة إنجليزية' },
      'math': { name: 'أ / محمد فوزي', subject: 'رياضيات' },
      'social': { name: 'أ / ياسر جاد', subject: 'دراسات' },
      'science': { name: 'أ / باسم', subject: 'علوم' }
    };

    // Data storage
    let attendanceData = {};
    let paymentData = {};
    let studentSettings = {
      name: '',
      grade: ''
    };

    // Initialize data from localStorage
    function loadData() {
      try {
        const savedAttendance = localStorage.getItem('attendanceData');
        const savedPayment = localStorage.getItem('paymentData');
        const savedSettings = localStorage.getItem('studentSettings');
        
        attendanceData = savedAttendance ? JSON.parse(savedAttendance) : {};
        paymentData = savedPayment ? JSON.parse(savedPayment) : {};
        
        if (savedSettings) {
          studentSettings = JSON.parse(savedSettings);
          if (studentSettings.name && studentSettings.grade) {
            hideSettingsSection();
          }
        }
      } catch (e) {
        console.error('Error loading ', e);
        attendanceData = {};
        paymentData = {};
      }
    }
    
    // Save data to localStorage
    function saveData() {
      try {
        localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
        localStorage.setItem('paymentData', JSON.stringify(paymentData));
        localStorage.setItem('studentSettings', JSON.stringify(studentSettings));
      } catch (e) {
        console.error('Error saving ', e);
      }
    }
    
    // Save student settings
    function saveStudentSettings() {
      const nameInput = document.getElementById('studentName');
      const gradeInput = document.getElementById('studentGrade');
      
      if (nameInput.value.trim() === '' || gradeInput.value.trim() === '') {
        alert('يرجى تعبئة جميع الحقول');
        return;
      }
      
      studentSettings.name = nameInput.value.trim();
      studentSettings.grade = gradeInput.value.trim();
      
      saveData();
      hideSettingsSection();
      alert('تم حفظ بيانات الطالب بنجاح');
    }
    
    // Hide settings section after saving
    function hideSettingsSection() {
      const settingsSection = document.getElementById('settingsSection');
      if (settingsSection) {
        settingsSection.classList.add('hidden');
      }
    }
    
    // Show profile modal
    function showProfileModal() {
      const modal = document.getElementById('profileModal');
      const nameInput = document.getElementById('modalStudentName');
      const gradeInput = document.getElementById('modalStudentGrade');
      
      nameInput.value = studentSettings.name;
      gradeInput.value = studentSettings.grade;
      
      modal.style.display = 'flex';
    }
    
    // Save student settings from modal
    function saveStudentSettingsFromModal() {
      const nameInput = document.getElementById('modalStudentName');
      const gradeInput = document.getElementById('modalStudentGrade');
      
      if (nameInput.value.trim() === '' || gradeInput.value.trim() === '') {
        alert('يرجى تعبئة جميع الحقول');
        return;
      }
      
      studentSettings.name = nameInput.value.trim();
      studentSettings.grade = gradeInput.value.trim();
      
      saveData();
      closeProfileModal();
      alert('تم تحديث بيانات الطالب بنجاح');
    }
    
    // Close profile modal
    function closeProfileModal() {
      const modal = document.getElementById('profileModal');
      modal.style.display = 'none';
    }
    
    // Show lesson modal
    function showLessonModal() {
      const modal = document.getElementById('lessonModal');
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('lessonDate').value = today;
      modal.style.display = 'flex';
    }
    
    // Close lesson modal
    function closeLessonModal() {
      const modal = document.getElementById('lessonModal');
      modal.style.display = 'none';
    }
    
    // Confirm add lesson
    function confirmAddLesson() {
      const dateInput = document.getElementById('lessonDate');
      const daySelect = document.getElementById('lessonDay');
      
      if (!dateInput.value) {
        alert('يرجى تحديد تاريخ الحصة');
        return;
      }
      
      const now = new Date();
      const lessons = attendanceData[currentTeacher];
      const currentGroupIndex = Math.floor(lessons.length / 8);
      const lessonsInCurrentGroup = lessons.length % 8;
      
      // Check if current group is full
      if (lessonsInCurrentGroup >= 8) {
        alert('لقد تم تسجيل 8 حصص للمجموعة الحالية. يرجى الانتظار حتى تبدأ المجموعة التالية.');
        closeLessonModal();
        return;
      }
      
      const newLesson = {
        number: lessons.length + 1,
        date: dateInput.value,
        day: daySelect.value
      };
      
      attendanceData[currentTeacher].push(newLesson);
   
