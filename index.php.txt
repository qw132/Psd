<?php
session_start();

// التحقق من تسجيل الدخول للمسؤول
if (isset($_POST['login'])) {
    $password = $_POST['password'];
    if ($password === "Mm232566") {
        $_SESSION['admin'] = true;
    } else {
        echo "<script>alert('كلمة السر غير صحيحة!');</script>";
    }
}

// تخزين بيانات التبرع في ملف
if (isset($_POST['donate'])) {
    $name = $_POST['name'];
    $wallet = $_POST['wallet'];
    $amount = $_POST['amount'];
    
    $data = "$name, $wallet, $amount, " . date("Y-m-d H:i:s") . "\n";
    file_put_contents('donations.txt', $data, FILE_APPEND);
    
    echo "<script>alert('تم تسجيل التبرع بنجاح!');</script>";
}

// تسجيل الخروج للمسؤول
if (isset($_POST['logout'])) {
    session_destroy();
    header("Location: index.php");
    exit();
}
?>

<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>صفحة التبرع لفلسطين</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f1f1f1; text-align: center; }
    form { background-color: white; padding: 20px; width: 60%; margin: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
    input, button { width: 100%; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    button { background-color: #4caf50; color: white; cursor: pointer; }
    .admin-section { margin-top: 20px; }
    table { width: 80%; margin: auto; background-color: white; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>صفحة التبرع لفلسطين</h1>

  <form method="POST">
    <input type="text" name="name" placeholder="اسمك بالكامل" required>
    <input type="text" name="wallet" placeholder="رقم محفظتك" required>
    <input type="number" name="amount" placeholder="المبلغ (بالجنيه)" required>
    <p>رقم محفظة التبرع: <strong>01040507023</strong></p>
    <button type="submit" name="donate">تأكيد التبرع</button>
  </form>

  <div class="admin-section">
    <form method="POST">
      <button type="submit" name="show_password">هل أنت مسؤول؟</button>
    </form>

    <?php if (isset($_POST['show_password'])): ?>
      <form method="POST">
        <input type="password" name="password" placeholder="أدخل كلمة السر">
        <button type="submit" name="login">تسجيل الدخول</button>
      </form>
    <?php endif; ?>

    <?php if (isset($_SESSION['admin'])): ?>
      <h2>سجل التبرعات:</h2>
      <table>
        <tr><th>الاسم</th><th>رقم المحفظة</th><th>المبلغ</th><th>التاريخ</th></tr>
        <?php
        $file = 'donations.txt';
        if (file_exists($file)) {
            $lines = file($file);
            foreach ($lines as $line) {
                $data = explode(',', $line);
                echo "<tr><td>{$data[0]}</td><td>{$data[1]}</td><td>{$data[2]}</td><td>{$data[3]}</td></tr>";
            }
        }
        ?>
      </table>
      <form method="POST">
        <button type="submit" name="logout">تسجيل الخروج</button>
      </form>
    <?php endif; ?>
  </div>
</body>
</html>